<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Monitoramento - Playboy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background: #0b0b0b; color: white; }
        .card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); }
        .stat-card { background: linear-gradient(135deg, #1a1a1a, #2a2a2a); }
        .online-indicator { 
            width: 8px; height: 8px; 
            background: #10b981; 
            border-radius: 50%; 
            animation: pulse 2s infinite; 
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .visitor-card { 
            background: linear-gradient(135deg, #1e1e1e, #2d2d2d); 
            border-left: 4px solid #e50914; 
        }
        .click-highlight { background: rgba(229, 9, 20, 0.2); }
        .location-badge { background: #3b82f6; }
        .age-badge { background: #8b5cf6; }
        .device-badge { background: #10b981; }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <header class="bg-black/70 backdrop-blur border-b border-white/10 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 bg-red-600 rounded-full flex items-center justify-center">
                        <span class="text-white font-bold text-sm">P</span>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">Dashboard de Monitoramento</h1>
                        <p class="text-sm text-gray-400">Playboy - An√°lise de Visitantes</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <div class="flex items-center gap-2">
                        <div class="online-indicator"></div>
                        <span class="text-sm text-green-400">Sistema Ativo</span>
                    </div>
                    <button onclick="refreshData()" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-md text-sm font-medium transition">
                        üîÑ Atualizar
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Estat√≠sticas Principais -->
    <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Total de Visitantes -->
            <div class="stat-card rounded-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-400">Total de Visitantes</p>
                        <p class="text-2xl font-bold text-white" id="totalVisitors">0</p>
                    </div>
                    <div class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center">
                        <span class="text-white text-xl">üë•</span>
                    </div>
                </div>
            </div>

            <!-- Cliques em Bot√µes -->
            <div class="stat-card rounded-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-400">Cliques em Bot√µes</p>
                        <p class="text-2xl font-bold text-white" id="totalClicks">0</p>
                    </div>
                    <div class="w-12 h-12 bg-green-600 rounded-full flex items-center justify-center">
                        <span class="text-white text-xl">üõí</span>
                    </div>
                </div>
            </div>

            <!-- Convers√£o -->
            <div class="stat-card rounded-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-400">Taxa de Convers√£o</p>
                        <p class="text-2xl font-bold text-white" id="conversionRate">0%</p>
                    </div>
                    <div class="w-12 h-12 bg-purple-600 rounded-full flex items-center justify-center">
                        <span class="text-white text-xl">üìà</span>
                    </div>
                </div>
            </div>

            <!-- Tempo M√©dio -->
            <div class="stat-card rounded-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-400">Tempo M√©dio</p>
                        <p class="text-2xl font-bold text-white" id="avgTime">0s</p>
                    </div>
                    <div class="w-12 h-12 bg-orange-600 rounded-full flex items-center justify-center">
                        <span class="text-white text-xl">‚è±Ô∏è</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Lista de Visitantes por Estado -->
        <div class="max-w-4xl mx-auto mb-8">
            <div class="card rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-4">Visitantes por Estado</h3>
                <div id="locationList" class="space-y-3">
                    <!-- Lista ser√° preenchida dinamicamente -->
                </div>
            </div>
        </div>

        <!-- Lista de Visitantes em Tempo Real -->
        <div class="card rounded-lg p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold">Visitantes Ativos</h3>
                <div class="flex items-center gap-2">
                    <div class="online-indicator"></div>
                    <span class="text-sm text-green-400" id="activeVisitors">0 visitantes online</span>
                </div>
            </div>
            
            <div class="space-y-4" id="visitorsList">
                <!-- Visitantes ser√£o inseridos aqui dinamicamente -->
            </div>
        </div>

        <!-- An√°lise Detalhada -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mt-8">
            <!-- Dispositivos -->
            <div class="card rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-4">Dispositivos</h3>
                <div id="deviceStats" class="space-y-3">
                    <!-- Estat√≠sticas de dispositivos -->
                </div>
            </div>

            <!-- Faixa Et√°ria Estimada -->
            <div class="card rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-4">Faixa Et√°ria</h3>
                <div id="ageStats" class="space-y-3">
                    <!-- Estat√≠sticas de idade -->
                </div>
            </div>

            <!-- Localiza√ß√£o -->
            <div class="card rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-4">Localiza√ß√£o</h3>
                <div id="locationStats" class="space-y-3">
                    <!-- Estat√≠sticas de localiza√ß√£o -->
                </div>
            </div>
        </div>
    </section>

    <!-- Scripts -->
    <script>
        let trackingData = [];
        let dashboardInitialized = false;

        // Inicializa o dashboard - VERS√ÉO SIMPLIFICADA
        function initDashboard() {
            console.log('üöÄ Inicializando dashboard est√°tico...');
            
            // Carrega dados apenas uma vez
            loadTrackingData();
            updateStats();
            updateVisitorsList();
            updateLocationList();
        }

        // Carrega dados do sistema de tracking
        function loadTrackingData() {
            // Tenta carregar dados do site Playboy
            if (typeof getPlayboyTrackingData === 'function') {
                trackingData = getPlayboyTrackingData();
                console.log('üìä Dados carregados do site Playboy:', trackingData.length, 'entradas');
            } else if (typeof getTrackingData === 'function') {
                trackingData = getTrackingData();
                console.log('üìä Dados carregados do sistema local:', trackingData.length, 'entradas');
            } else {
                // Dados de exemplo para demonstra√ß√£o
                trackingData = getSampleData();
                console.log('üìä Usando dados de exemplo:', trackingData.length, 'entradas');
            }
        }

        // Dados de exemplo para demonstra√ß√£o
        function getSampleData() {
            return [
                {
                    sessionId: 'visitor_1703123456789_abc123',
                    timestamp: new Date(Date.now() - 300000).toISOString(),
                    type: 'geolocation',
                    data: {
                        city: 'S√£o Paulo',
                        state: 'SP',
                        country: 'Brasil'
                    }
                },
                {
                    sessionId: 'visitor_1703123456789_abc123',
                    timestamp: new Date(Date.now() - 200000).toISOString(),
                    type: 'button_click',
                    data: {
                        packageName: 'Pacote Premium',
                        price: 'R$ 19,90'
                    }
                },
                {
                    sessionId: 'visitor_1703123456789_def456',
                    timestamp: new Date(Date.now() - 150000).toISOString(),
                    type: 'geolocation',
                    data: {
                        city: 'Rio de Janeiro',
                        state: 'RJ',
                        country: 'Brasil'
                    }
                },
                {
                    sessionId: 'visitor_1703123456789_def456',
                    timestamp: new Date(Date.now() - 100000).toISOString(),
                    type: 'button_click',
                    data: {
                        packageName: 'Pacote Sedu√ß√£o',
                        price: 'R$ 10,00'
                    }
                }
            ];
        }

        // Atualiza estat√≠sticas - VERS√ÉO EST√ÅTICA
        function updateStats() {
            // Dados est√°ticos para demonstra√ß√£o
            document.getElementById('totalVisitors').textContent = '33';
            document.getElementById('totalClicks').textContent = '12';
            document.getElementById('conversionRate').textContent = '36%';
            document.getElementById('avgTime').textContent = '2m 15s';
            document.getElementById('activeVisitors').textContent = '5 visitantes online';
        }

        // Obt√©m visitantes √∫nicos
        function getUniqueVisitors() {
            const sessions = new Set();
            trackingData.forEach(entry => {
                sessions.add(entry.sessionId);
            });
            return Array.from(sessions);
        }

        // Obt√©m cliques em bot√µes
        function getButtonClicks() {
            return trackingData.filter(entry => entry.type === 'button_click');
        }

        // Calcula taxa de convers√£o
        function calculateConversionRate() {
            const visitors = getUniqueVisitors().length;
            const clicks = getButtonClicks().length;
            return visitors > 0 ? Math.round((clicks / visitors) * 100) : 0;
        }

        // Calcula tempo m√©dio
        function calculateAverageTime() {
            const timeEntries = trackingData.filter(entry => entry.type === 'time_tracking');
            if (timeEntries.length === 0) return 0;
            
            const totalTime = timeEntries.reduce((sum, entry) => sum + (entry.data.timeOnPage || 0), 0);
            return Math.round(totalTime / timeEntries.length);
        }

        // Atualiza lista de visitantes - VERS√ÉO EST√ÅTICA
        function updateVisitorsList() {
            const visitorsList = document.getElementById('visitorsList');
            if (!visitorsList) return;
            
            // Dados est√°ticos para demonstra√ß√£o
            const staticVisitors = [
                {
                    sessionId: 'playboy_001',
                    location: { city: 'S√£o Paulo', state: 'SP' },
                    device: 'Desktop',
                    clicks: [{ packageName: 'Pacote Premium', price: 'R$ 19,90' }],
                    timestamp: new Date().toISOString()
                },
                {
                    sessionId: 'playboy_002', 
                    location: { city: 'Rio de Janeiro', state: 'RJ' },
                    device: 'Mobile',
                    clicks: [{ packageName: 'Pacote Sedu√ß√£o', price: 'R$ 10,00' }],
                    timestamp: new Date(Date.now() - 300000).toISOString()
                }
            ];
            
            visitorsList.innerHTML = staticVisitors.map(visitor => {
                return `
                    <div class="visitor-card rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-red-600 rounded-full flex items-center justify-center">
                                    <span class="text-white font-bold text-sm">V</span>
                                </div>
                                <div>
                                    <p class="font-semibold">Visitante ${visitor.sessionId.slice(-3)}</p>
                                    <p class="text-sm text-gray-400">${new Date(visitor.timestamp).toLocaleString()}</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="online-indicator"></div>
                                <span class="text-sm text-green-400">Online</span>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <p class="text-sm text-gray-400">Localiza√ß√£o</p>
                                <div class="flex items-center gap-2 mt-1">
                                    <span class="location-badge text-xs px-2 py-1 rounded">${visitor.location.city}</span>
                                    <span class="text-sm">${visitor.location.state}</span>
                                </div>
                            </div>
                            
                            <div>
                                <p class="text-sm text-gray-400">Dispositivo</p>
                                <div class="flex items-center gap-2 mt-1">
                                    <span class="device-badge text-xs px-2 py-1 rounded">${visitor.device}</span>
                                </div>
                            </div>
                            
                            <div>
                                <p class="text-sm text-gray-400">A√ß√µes</p>
                                <div class="flex items-center gap-2 mt-1">
                                    <span class="click-highlight text-xs px-2 py-1 rounded">${visitor.clicks.length} cliques</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-3 pt-3 border-t border-gray-700">
                            <p class="text-sm text-gray-400 mb-2">Cliques registrados:</p>
                            <div class="space-y-1">
                                ${visitor.clicks.map(click => `
                                    <div class="flex items-center justify-between text-sm">
                                        <span>${click.packageName}</span>
                                        <span class="text-green-400 font-semibold">${click.price}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Determina tipo de dispositivo
        function getDeviceType(userAgent) {
            if (!userAgent) return 'Desconhecido';
            const ua = userAgent.toLowerCase();
            if (/mobile|android|iphone/.test(ua)) return 'Mobile';
            if (/tablet|ipad/.test(ua)) return 'Tablet';
            return 'Desktop';
        }

        // Gr√°ficos removidos - apenas lista de estados

        // Lista de visitantes por estado - VERS√ÉO EST√ÅTICA
        function updateLocationList() {
            const locationList = document.getElementById('locationList');
            if (!locationList) return;
            
            // Dados est√°ticos
            const staticLocations = [
                { state: 'S√£o Paulo', count: 15, percentage: 45 },
                { state: 'Rio de Janeiro', count: 8, percentage: 24 },
                { state: 'Minas Gerais', count: 5, percentage: 15 },
                { state: 'Bahia', count: 3, percentage: 9 },
                { state: 'Paran√°', count: 2, percentage: 6 }
            ];

            locationList.innerHTML = staticLocations.map(location => {
                return `
                    <div class="flex items-center justify-between p-3 bg-gray-800/50 rounded-lg hover:bg-gray-700/50 transition">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 bg-red-600 rounded-full flex items-center justify-center">
                                <span class="text-white font-bold text-xs">${location.state.slice(0, 2)}</span>
                            </div>
                            <div>
                                <p class="font-semibold">${location.state}</p>
                                <p class="text-sm text-gray-400">${location.count} visitante${location.count !== 1 ? 's' : ''}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-lg font-bold text-red-400">${location.count}</p>
                            <p class="text-sm text-gray-400">${location.percentage}%</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Atualiza dados
        function refreshData() {
            console.log('üîÑ Atualizando dados manualmente...');
            
            loadTrackingData();
            updateStats();
            updateVisitorsList();
            updateLocationList();
            
            // Mostra notifica√ß√£o
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = '‚úÖ Atualizado!';
            button.disabled = true;
            
            setTimeout(() => {
                button.textContent = originalText;
                button.disabled = false;
            }, 2000);
        }

        // Inicializa quando a p√°gina carrega
        document.addEventListener('DOMContentLoaded', function() {
            // Aguarda um pouco para garantir que tudo est√° carregado
            setTimeout(initDashboard, 100);
        });
    </script>
</body>
</html>
